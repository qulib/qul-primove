{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/01OCUL_QU-QU_DEFAULT/js/main.js","primo-explore/custom/01OCUL_QU-QU_DEFAULT/node_modules/primo-explore-hathitrust-availability/index.js","primo-explore/custom/01OCUL_QU-QU_DEFAULT/node_modules/primo-explore-hathitrust-availability/js/hathi-trust-availability.module.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","angular","component","template","x","document","createElement","type","async","src","y","getElementsByTagName","parentNode","insertBefore","chat","innerHTML","body","appendChild","constant","config","$sceDelegateProvider","hathiTrustBaseUrl","urlWhitelist","resourceUrlWhitelist","push","factory","$http","$q","svc","lookup","ids","hathiTrustLookupUrl","join","jsonp","cache","jsonpCallbackParam","then","resp","data","resolve","findRecord","bibData","recordId","Object","keys","records","recordURL","catch","console","error","findFullViewRecord","fullTextUrl","result","j","items","item","usRightsString","toLowerCase","fromRecord","controller","hathiTrust","self","this","$onInit","msg","hideOnline","isOnline","hideIfJournal","isJournal","ignoreCopyright","isAvailable","updateHathiTrustAvailability","prmSearchResultAvailabilityLine","pnx","addata","format","indexOf","delivery","availability","GetIt1","some","g","links","isLinktoOnline","deliveryCategory","isOclcNum","value","match","hathiTrustIds","oclcid","filter","map","id","replace","res","link","fullTextLink","entityId","bindings"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","import 'primo-explore-hathitrust-availability';\n(function () {\n    'use strict';\n    var app = angular.module('viewCustom', ['angularLoad', 'hathiTrustAvailability']);\n    // Include HathiTrust full text links.\n    app.component('prmSearchResultAvailabilityLineAfter', {\n        template: '<hathi-trust-availability msg=\"Full Text Available Online at HathiTrust\" ignore-copyright=\"true\" entity-id=\"https://login.queensu.ca/idp/shibboleth\"></hathi-trust-availability>'\n    })\n/*----------below is the code for libraryh3lp -----------*/\nvar x = document.createElement(\"script\");\nx.type = \"text/javascript\";\nx.async = true;\nx.src = \"https://ca.libraryh3lp.com/js/libraryh3lp.js?776\";\nvar y = document.getElementsByTagName(\"script\")[0];\ny.parentNode.insertBefore(x, y);\n\nvar chat = document.createElement(\"div\");\nchat.innerHTML = '<div class=\"needs-js\"></div>';\ndocument.body.appendChild(chat);\n/*--------------- libraryh3lp code ends here---------------*/\n})();\n","require('./js/hathi-trust-availability.module.js');\nmodule.exports = 'hathiTrustAvailability';\n","angular\n  .module('hathiTrustAvailability', [])\n  .constant(\n    'hathiTrustBaseUrl',\n    'https://catalog.hathitrust.org/api/volumes/brief/json/'\n  )\n  .config([\n    '$sceDelegateProvider',\n    'hathiTrustBaseUrl',\n    function ($sceDelegateProvider, hathiTrustBaseUrl) {\n      var urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n      urlWhitelist.push(hathiTrustBaseUrl + '**');\n      $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n    },\n  ])\n  .factory('hathiTrust', [\n    '$http',\n    '$q',\n    'hathiTrustBaseUrl',\n    function ($http, $q, hathiTrustBaseUrl) {\n      var svc = {};\n\n      var lookup = function (ids) {\n        if (ids.length) {\n          var hathiTrustLookupUrl = hathiTrustBaseUrl + ids.join('|');\n          return $http\n            .jsonp(hathiTrustLookupUrl, {\n              cache: true,\n              jsonpCallbackParam: 'callback',\n            })\n            .then(function (resp) {\n              return resp.data;\n            });\n        } else {\n          return $q.resolve(null);\n        }\n      };\n\n      // find a HT record URL for a given list of identifiers (regardless of copyright status)\n      svc.findRecord = function (ids) {\n        return lookup(ids)\n          .then(function (bibData) {\n            for (var i = 0; i < ids.length; i++) {\n              var recordId = Object.keys(bibData[ids[i]].records)[0];\n              if (recordId) {\n                return $q.resolve(bibData[ids[i]].records[recordId].recordURL);\n              }\n            }\n            return $q.resolve(null);\n          })\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      // find a public-domain HT record URL for a given list of identifiers\n      svc.findFullViewRecord = function (ids) {\n        var handleResponse = function (bibData) {\n          var fullTextUrl = null;\n          for (var i = 0; !fullTextUrl && i < ids.length; i++) {\n            var result = bibData[ids[i]];\n            for (var j = 0; j < result.items.length; j++) {\n              var item = result.items[j];\n              if (item.usRightsString.toLowerCase() === 'full view') {\n                fullTextUrl = result.records[item.fromRecord].recordURL;\n                break;\n              }\n            }\n          }\n          return $q.resolve(fullTextUrl);\n        };\n        return lookup(ids)\n          .then(handleResponse)\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      return svc;\n    },\n  ])\n  .controller('hathiTrustAvailabilityController', [\n    'hathiTrust',\n    function (hathiTrust) {\n      var self = this;\n\n      self.$onInit = function () {\n        if (!self.msg) self.msg = 'Full Text Available at HathiTrust';\n\n        // prevent appearance/request iff 'hide-online'\n        if (self.hideOnline && isOnline()) {\n          return;\n        }\n\n        // prevent appearance/request iff 'hide-if-journal'\n        if (self.hideIfJournal && isJournal()) {\n          return;\n        }\n\n    \t// prevent appearance/request if item is unavailable\n    \tif (self.ignoreCopyright && !isAvailable()) {\n    \t   //allow links for locally unavailable items that are in the public domain\n           self.ignoreCopyright=false;\n        }\n\n        // look for full text at HathiTrust\n        updateHathiTrustAvailability();\n      };\n\n      var isJournal = function () {\n        var format =\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.format[0];\n        return !(format.toLowerCase().indexOf('journal') == -1); // format.includes(\"Journal\")\n      };\n\n      var isAvailable = function isAvailable() {\n\tvar available = self.prmSearchResultAvailabilityLine.result.delivery.availability[0];\n\treturn (available.toLowerCase().indexOf('unavailable') == -1); \n      };\n\n      var isOnline = function () {\n        var delivery =\n          self.prmSearchResultAvailabilityLine.result.delivery || [];\n        if (!delivery.GetIt1)\n          return delivery.deliveryCategory.indexOf('Alma-E') !== -1;\n        return self.prmSearchResultAvailabilityLine.result.delivery.GetIt1.some(\n          function (g) {\n            return g.links.some(function (l) {\n              return l.isLinktoOnline;\n            });\n          }\n        );\n      };\n\n      var formatLink = function (link) {\n        return self.entityId ? link + '?signon=swle:' + self.entityId : link;\n      };\n\n      var isOclcNum = function (value) {\n        // return value.match(/^(\\(ocolc\\))?\\d+$/i);\n        return value.match(/^\\(ocolc\\).+/i);\n      };\n\n      var updateHathiTrustAvailability = function () {\n        var hathiTrustIds = (\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.oclcid || []\n        )\n          .filter(isOclcNum)\n          .map(function (id) {\n            return 'oclc:' + id.toLowerCase().replace('(ocolc)', '');\n          });\n        hathiTrust[self.ignoreCopyright ? 'findRecord' : 'findFullViewRecord'](\n          hathiTrustIds\n        ).then(function (res) {\n          if (res) self.fullTextLink = formatLink(res);\n        });\n      };\n    },\n  ])\n  .component('hathiTrustAvailability', {\n    require: {\n      prmSearchResultAvailabilityLine: '^prmSearchResultAvailabilityLine',\n    },\n    bindings: {\n      entityId: '@',\n      ignoreCopyright: '<',\n      hideIfJournal: '<',\n      hideOnline: '<',\n      msg: '@?',\n    },\n    controller: 'hathiTrustAvailabilityController',\n    template:\n      '<span ng-if=\"$ctrl.fullTextLink\" class=\"umnHathiTrustLink\">\\\n                <md-icon alt=\"HathiTrust Logo\">\\\n                  <svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\" xml:space=\"preserve\">  <image id=\"image0\" width=\"16\" height=\"16\" x=\"0\" y=\"0\"\\\n                  xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\\\n                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEXuegXvegTsewTveArw\\\n                  eQjuegftegfweQXsegXweQbtegnsegvxeQbvegbuegbvegbveQbtegfuegbvegXveQbvegbsfAzt\\\n                  plfnsmfpq1/wplPuegXvqFrrq1znr2Ptok/sewvueQfuegbtegbrgRfxyJPlsXDmlTznnk/rn03q\\\n                  pVnomkjnlkDnsGnvwobsfhPveQXteQrutHDqpF3qnUnpjS/prmDweQXsewjvrWHsjy7pnkvqqGDv\\\n                  t3PregvqhB3uuXjusmzpp13qlz3pfxTskC3uegjsjyvogBfpmkHpqF/us2rttXLrgRjrgBjttXDo\\\n                  gx/vtGznjzPtfhHqjCfuewfrjCnwfxLpjC7wtnDogBvssmjpfhLtegjtnEjrtnTmjC/utGrsew7s\\\n                  o0zpghnohB/roUrrfRHtsmnlkTbrvH3tnEXtegXvegTveQfqhyHvuXjrrGTpewrsrmXqfRHogRjt\\\n                  q2Dqewvqql/wu3vqhyDueQnwegXuegfweQPtegntnUvnt3fvxI7tfhTrfA/vzJvmtXLunEbtegrw\\\n                  egTregzskjbsxI/ouoPsqFzniyrz2K3vyZnokDLpewvtnkv30J/w17XsvYXjgBbohR7nplnso1L0\\\n                  1Kf40Z/um0LvegXngBnsy5juyJXvsGftrGTnhB/opVHoew7qhB7rzJnnmErkkz3splbqlT3smT3t\\\n                  tXPqqV7pjzHvunjrfQ7vewPsfA7uoU3uqlruoEzsfQ/vegf///9WgM4fAAAAFHRSTlOLi4uLi4uL\\\n                  i4uLi4uLi4tRUVFRUYI6/KEAAAABYktHRLvUtndMAAAAB3RJTUUH4AkNDgYNB5/9vwAAAQpJREFU\\\n                  GNNjYGBkYmZhZWNn5ODk4ubh5WMQERUTl5CUEpWWkZWTV1BUYlBWUVVT19BUUtbS1tHV0zdgMDQy\\\n                  NjE1MzRXsrC0sraxtWOwd3B0cnZxlXZz9/D08vbxZfDzDwgMCg4JdQsLj4iMio5hiI2LT0hMSk5J\\\n                  TUvPyMzKzmHIzcsvKCwqLiktK6+orKquYZCuratvaGxqbmlta+8QNRBl6JQ26Oru6e3rnzBx0uQ8\\\n                  aVGGvJopU6dNn1E8c9bsOXPniYoySM+PXbBw0eIlS5fl1C+PFRFlEBUVXbFy1eo1a9fliQDZYIHY\\\n                  9fEbNm7avEUUJiC6ddv2HTt3mSuBBfhBQEBQSEgYzOIHAHtfTe/vX0uvAAAAJXRFWHRkYXRlOmNy\\\n                  ZWF0ZQAyMDE2LTA5LTEzVDE0OjA2OjEzLTA1OjAwNMgVqAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAx\\\n                  Ni0wOS0xM1QxNDowNjoxMy0wNTowMEWVrRQAAAAASUVORK5CYII=\" />\\\n                  </svg> \\\n                </md-icon>\\\n                <a target=\"_blank\" ng-href=\"{{$ctrl.fullTextLink}}\">\\\n                {{ ::$ctrl.msg }}\\\n                  <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\n                </a>\\\n              </span>',\n  });\n"],"sourceRoot":"/source/"}